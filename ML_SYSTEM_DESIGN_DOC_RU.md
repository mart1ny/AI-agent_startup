# ML System Design Doc - [RU]
## Дизайн ML системы - AI-ассистент анализа стартапов MVP 1
Шаблон ML System Design Doc от телеграм-канала Reliable ML

Рекомендации по процессу заполнения документа (workflow) - здесь.  
Детальный доклад о том, что такое ML System Design Doc и о том, как, когда и зачем его составлять - тут.

Термины и пояснения  
Итерация - это все работы, которые совершаются до старта очередного пилота  
БТ - бизнес-требования  
EDA - Exploratory Data Analysis - исследовательский анализ данных  
Product Owner, Data Scientist - роли, которые заполняют соответствующие разделы  
В этом шаблоне роль Data Scientist совмещает в себе компетенции классического Data Scientist с упором на исследования и ML Engineer & ML Ops роли с акцентом на продуктивизацию моделей  
Для вашей организации распределение ролей может быть уточнено в зависимости от операционной модели

## Оглавление
- [1. Цели и предпосылки](#1-цели-и-предпосылки)
  - [1.1. Зачем идем в разработку продукта?](#11-зачем-идем-в-разработку-продукта)
  - [1.2. Бизнес-требования и ограничения](#12-бизнес-требования-и-ограничения)
  - [1.3. Что входит в скоуп проекта/итерации, что не входит](#13-что-входит-в-скоуп-проектаитерации-что-не-входит)
  - [1.4. Предпосылки решения](#14-предпосылки-решения)
- [2. Методология](#2-методология)
  - [2.1. Постановка задачи](#21-постановка-задачи)
  - [2.2. Блок-схема решения](#22-блок-схема-решения)
  - [2.3. Этапы решения задачи](#23-этапы-решения-задачи)
- [3. Подготовка пилота](#3-подготовка-пилота)
  - [3.1. Способ оценки пилота](#31-способ-оценки-пилота)
  - [3.2. Что считаем успешным пилотом](#32-что-считаем-успешным-пилотом)
  - [3.3. Подготовка пилота](#33-подготовка-пилота)
- [4. Внедрение для production систем](#4-внедрение-для-production-систем)
  - [4.1. Архитектура решения](#41-архитектура-решения)
  - [4.2. Описание инфраструктуры и масштабируемости](#42-описание-инфраструктуры-и-масштабируемости)
  - [4.3. Требования к работе системы](#43-требования-к-работе-системы)
  - [4.4. Безопасность системы](#44-безопасность-системы)
  - [4.5. Безопасность данных](#45-безопасность-данных)
  - [4.6. Издержки](#46-издержки)
  - [4.7. Integration points](#47-integration-points)
  - [4.8. Риски](#48-риски)
- [Материалы для дополнительного погружения](#материалы-для-дополнительного-погружения)

## 1. Цели и предпосылки

### 1.1. Зачем идем в разработку продукта?
**Бизнес-цель (Product Owner)**  
Запустить MVP ассистента, который быстро и стандартизированно анализирует стартап-идеи и повышает конверсию в пилот/оплату.

**Почему станет лучше, чем сейчас (Product Owner & Data Scientist)**  
Сейчас разборы делаются вручную и несопоставимы по структуре. ML-ассистент дает единый формат отчета за минуты и снижает нагрузку на аналитиков.

**Что будем считать успехом итерации (Product Owner)**  
Автоматический отчет без участия аналитика в >= 70% случаев и рост конверсии в следующий шаг на >= 15%.

### 1.2. Бизнес-требования и ограничения
**Краткое описание БТ и ссылки на детальные документы (Product Owner)**  
Ассистент принимает описание стартапа и выдает отчет с блоками: рынок, unit-экономика, GTM, риски, антипаттерны, рекомендации. Детальные требования будут оформлены в PRD.

**Бизнес-ограничения (Product Owner)**  
Время ответа <= 60 сек для 95% запросов. Нет внешних платных источников на MVP.

**Что ожидаем от итерации (Product Owner)**  
Рабочий RAG-пайплайн на внутренней базе знаний и стабильный шаблон ответа.

**Бизнес-процесс пилота (Product Owner)**  
Пользователь отправляет описание идеи, система формирует отчет, далее пользователь/аналитик оценивает полезность и принимает решение о следующем шаге.

**Успех пилота (Product Owner)**  
Полезность >= 4/5 по опросу и снижение времени на разбор >= 50%. Дальше — масштабирование базы знаний и интеграции в CRM.

### 1.3. Что входит в скоуп проекта/итерации, что не входит
**Входит (Data Scientist)**  
Автоматическое формирование отчета по шаблону и ранжирование рисков на основе базы знаний.

**Не входит (Data Scientist)**  
Глубокая проверка фактов во внешних источниках и автоматическое решение об инвестиции.

**Качество кода и воспроизводимость (Data Scientist)**  
Версионирование промптов, воспроизводимая сборка индекса знаний, повторяемый инференс при фиксированной версии модели.

**Планируемый технический долг (Data Scientist)**  
Нет полноценного мониторинга качества по сегментам и дрейфа, ограниченный аудит безопасности.

### 1.4. Предпосылки решения
**Общие предпосылки (Data Scientist)**  
Используем внутреннюю базу знаний (market_fit, unit_economics, gtm, anti_patterns, risk_categories). Горизонт анализа — текущая идея, гранулярность — один стартап на запрос.

## 2. Методология

### 2.1. Постановка задачи
**Техническая формулировка (Data Scientist)**  
RAG: семантический поиск по базе знаний и генерация структурированного отчета.

### 2.2. Блок-схема решения
**Baseline**  
User Input -> Prompt Template -> LLM -> Structured Report

**MVP**  
User Input -> Embedding -> Vector Search -> Retrieved Context -> Prompt Template -> LLM -> Structured Report

### 2.3. Этапы решения задачи
(Детализируется по итогам EDA; описывается отдельно для бейзлайна и MVP.)

**Этап 1 — Подготовка данных**  
Данные и сущности:

Название данных | Есть ли данные в компании | Требуемый ресурс | Проверено ли качество
--- | --- | --- | ---
Описание стартапов (форма) | Да, product_db | BE/DS | нет
market_fit | Да, knowledge_base | DS | да
unit_economics | Да, knowledge_base | DS | да
gtm | Да, knowledge_base | DS | да
anti_patterns | Да, knowledge_base | DS | да
risk_categories | Да, knowledge_base | DS | да

Результат: единый корпус знаний, очищенный от шумовых секций, и индекс в векторном хранилище.

**Этап 2 — Подготовка прогнозных моделей**  
Формирование выборки:  
- Baseline — 50-100 типовых описаний стартапов (исторические или синтетические).  
- MVP — те же описания + разметка релевантности фрагментов базы знаний.

Горизонт/гранулярность/частота: один отчет на один запрос, пересчет при каждом новом запросе.  
Целевая переменная: оценка полезности отчета пользователем по шкале 1-5.  
Метрики:  
- Baseline — доля отчетов >= 4/5 и среднее время ответа.  
- MVP — улучшение полезности на >= 10 п.п. относительно baseline и стабильная структура отчета.  
Риски: нерелевантный контекст; план — ограничение top-k и фильтры по теме.  
Принципы: feature engineering — текстовый контекст из базы знаний; алгоритм — LLM + RAG; кросс-валидация не применима, используем отложенную выборку.  
Бизнес-проверка: ручной review 10% отчетов на пилоте с анкетой оценки.

**Этап 3 — Интерпретация моделей (согласование с заказчиком)**  
Совместная проверка структуры отчета и корректировка шаблона.

**Этап 4 — Интеграция бизнес-правил для расчета бизнес-метрик качества модели**  
Формализация метрик успешности пилота: полезность, время ответа, полнота структуры.

**Этап 5 — Подготовка инференса модели по итерациям**  
Стабилизация промпта, контроль длины ответа, логирование входа и выхода.

**Этап 6 — Интеграция бизнес-правил**  
Запрет на инвестиционные рекомендации и токсичные формулировки.

**Этап 7 — Разработка оптимизатора (выбор оптимальной итерации)**  
Выбор версии промпта и параметров retrieval с лучшей полезностью и стабильностью.

**Этап 8 — Подготовка финального отчета для бизнеса**  
Сводка по метрикам пилота, ключевые находки и план следующей итерации.

## 3. Подготовка пилота

### 3.1. Способ оценки пилота
A/B тест: baseline (без RAG) vs MVP (RAG) на двух группах пользователей.

### 3.2. Что считаем успешным пилотом
Полезность >= 4/5 у >= 60% пользователей, время ответа <= 60 сек для 95% запросов.

### 3.3. Подготовка пилота
Ограничиваем контекст retrieval до 5-8 документов и max tokens. При превышении бюджета — кэш и уменьшение контекста.

## 4. Внедрение для production систем

### 4.1. Архитектура решения
API -> Prompt Service -> Vector Store -> LLM Inference -> Response

### 4.2. Описание инфраструктуры и масштабируемости
Локальный LLM (llama.cpp) и локальное векторное хранилище для MVP.  
Плюсы: низкие затраты, контроль данных. Минусы: ограничение качества и скорости.  
Почему выбор лучше альтернатив: для MVP важна автономность и стоимость, качество достаточно для пилота.

### 4.3. Требования к работе системы
SLA: 95% запросов <= 60 сек, пропускная способность 5 rps.

### 4.4. Безопасность системы
Потенциальная уязвимость: prompt injection; план — фильтрация входа и ограничения инструкций.

### 4.5. Безопасность данных
PII минимальны, GDPR не затрагивается при отсутствии персональных данных.

### 4.6. Издержки
200-500 USD/мес в зависимости от нагрузки и железа.

### 4.7. Integration points
REST API: /analyze, /feedback. Логи: storage для запросов и оценок.

### 4.8. Риски
Низкое качество входных данных, галлюцинации, устаревание базы знаний.


